<form>
  <div class="form-group row">
    <div class="col">
      <div class="custom-file">
        <input type="file" class="custom-file-input" id="customFile"
          (change)="handleVideoFileInput($event.target.files)"
          [disabled]="analysisLoading || validateLoading">
        <label class="custom-file-label" for="customFile">{{videoFile ? videoFile.name : 'Choose file'}}</label>
      </div><br>
      @if (supportedMessage) {
        <small class="text-success"><i class="fas fa-check-circle"></i>&nbsp;
        {{supportedMessage}}
      </small>
    }
    @if (unsupportedMessage) {
      <small class="text-warning">
        <i class="fas fa-exclamation-triangle"></i>&nbsp;
        {{unsupportedMessage}}
      </small>
    }
  </div>
</div>
@if (analysisLoading) {
  <div>
    <i class="fas fa-spinner fa-spin mr-2"></i>Analysing file...<br>
  </div>
}
@if (videoFile) {
  <div class="row mb-3">
    <div class="col">
      @if (!showAdvancedOptions) {
        <button class="btn btn-link" (click)="showAdvancedOptions = true">
          Show advanced options&nbsp;<i class="fas fa-angle-right"></i>
        </button>
      }
      @if (showAdvancedOptions) {
        <button class="btn btn-link" (click)="showAdvancedOptions = false">
          Hide advanced options&nbsp;<i class="fas fa-angle-down"></i>
        </button>
      }
      @if (showAdvancedOptions) {
        <form [formGroup]="optionsForm">
          <div class="form-group">
            <label for="selectVideoStream">Video</label>
            <select [disabled]="analysisLoading || validateLoading" class="form-control" id="selectVideoStream"
              formControlName="videoStreamControl">
              @for (videoStream of videoStreams; track videoStream) {
                <option [ngValue]="videoStream">
                  Video Stream #{{videoStream.index}}: {{videoStream.codec}}
                </option>
              }
            </select>
            @if (optionsForm.get('videoStreamControl').invalid && optionsForm.get('videoStreamControl').errors.invalidCodec) {
              <small
                class="text-warning">
                This track will need transcoding.
              </small>
            }
          </div>
          <div class="form-group">
            <label for="selectAudioStream">Audio</label>
            <select [disabled]="analysisLoading || validateLoading" class="form-control" id="selectAudioStream"
              formControlName="audioStreamControl">
              @for (audioStream of audioStreams; track audioStream) {
                <option [ngValue]="audioStream">
                  Audio Stream #{{audioStream.index}} {{audioStream.language}}:
                  {{audioStream.codec}}
                </option>
              }
            </select>
            @if (optionsForm.get('audioStreamControl').invalid && optionsForm.get('audioStreamControl').errors.invalidCodec) {
              <small
                class="text-warning">
                This track will need transcoding.
              </small>
            }
          </div>
          @if (subtitleStreams && subtitleStreams.length) {
            <div class="form-group">
              <label for="selectSubtitleStream">Subtitle</label>
              <select class="form-control" id="selectSubtitleStream" formControlName="subtitleStreamControl">
                @for (subtitleStream of subtitleStreams; track subtitleStream) {
                  <option [ngValue]="subtitleStream">
                    Subtitle Stream #{{subtitleStream.index}} {{subtitleStream.language}}:
                    {{subtitleStream.type}}
                  </option>
                }
              </select>
              @if (!isSubtitlesSupported) {
                <small class="text-warning">
                  <i class="fas fa-exclamation-triangle"></i>&nbsp;
                  dvd_subtitle format is not supported: you should add a custom subtitle file.
                </small>
              }
            </div>
          }
          <div class="form-group">
            @if (subtitleStreams && subtitleStreams.length) {
              <label for="customSubtitleFile">
                Or use custom subtitle file
              </label>
            }
            @if (!(subtitleStreams && subtitleStreams.length)) {
              <label for="customSubtitleFile">Custom
                subtitle
                file
              </label>
            }
            <div class="custom-file" id="customSubtitleFile">
              <input type="file" class="custom-file-input" id="customFile"
                (change)="handleSubtitlesFileInput($event.target.files)"
                formControlName="subtitleFileControl">
              <label class="custom-file-label"
              for="customFile">{{subtitlesFile ? subtitlesFile.name : 'Choose file'}}</label>
            </div>
          </div>
        </form>
      }
    </div>
  </div>
}
</form>
@if (validateLoading) {
  <div class="row mb-3">
    <div class="col">
      <div class="row">
        <div class="col">
          <i class="fas fa-spinner fa-spin mr-2"></i>Prepping the file for streaming...<br>
        </div>
      </div>
      <div class="row">
        <div class="col">
          <ngb-progressbar type="info" [value]="transcodingProgress" [striped]="true" [animated]="true">
            {{transcodingProgress}}%
          </ngb-progressbar>
        </div>
      </div>
    </div>
  </div>
}
@if (error) {
  <div class="row">
    <div class="col">
      <div class="alert alert-danger">{{error}}</div>
    </div>
  </div>
}
<div class="row">
  <div class="col d-flex justify-content-end">
    <button type="button" class="btn btn-success" (click)="validate()" [disabled]="!videoFile || validateLoading">
      @if (validateLoading) {
        <i class="fas fa-spinner fa-spin mr-2"></i>
        }Validate
      </button>
    </div>
  </div>